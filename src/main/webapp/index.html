<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
        html {
            font-family: sans-serif;
        }

        body {
            background-color: #eee;
        }

        .quizz {
            width: 30rem;
            margin: 0 auto;


        }

        #quizz__question {
            font-weight: normal;
            font-size: 1.2rem;
        }

        #modal__body--icon {
            padding: 0.5rem;
            border-radius: 50%;
            background-color: green;
            color: white;
            margin-left: 1rem;

        }
    </style>
</head>
<body>
<div class="quizz">
    <h3 id="quizz__question"></h3>
    <input type="submit" onclick="calculator()" value="Nộp bài">
    <input type="submit" onclick="addQuizz()" value="Add">
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Quizz</h5>

            </div>
            <div class="modal-body" id="modal__body">
                <div id="modal__body--question">
                    <h5>Question</h5>
                    <input type="text" placeholder="question" size="50" id="question">
                    <i class="fa fa-plus" id="modal__body--icon" onclick="addAnswer()"></i>
                </div>

            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" type="button" class="btn btn-secondary" data-dismiss="modal">Close
                </button>
                <button type="button" class="btn btn-primary" onclick="AddQuestion()">Add</button>
            </div>
        </div>
    </div>
</div>
<script>
    let array = [];
    let number=0;

    load();
    function AddQuestion()
    {
        let checkbox=document.getElementsByName('answer');
        let question=document.getElementById('question');
        let isRadio=0;
        for(let i=0;i<checkbox.length;i++)
        {
            if(checkbox[i].checked==true)
                isRadio+=1;
        }
        if(isRadio>1)
        {
            var obj={
                content:question,
                type:2
            }
        }
        else{
            var obj={
                content:question,
                type:1
            }
        }
        console.log(question);

        console.log(checkbox);
    }
    function isCheck(data) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/v1/answer/" + data,
            success: function (list) {
                var obj = {
                    id: data,
                    radio: document.getElementsByName(data),
                    list: list,
                }
                addArray(obj);
            },
        });
        // console.log(array);
    }

    function addArray(obj) {
        array.push(obj);
        for (let i = 0; i < obj.list.length; i++) {
            if (obj.list[i].isTrue == 1 && obj.radio[i].checked == false || obj.list[i].isTrue == 0 && obj.radio[i].checked == true) {
                // console.log(obj.radio[i].checked);
                return;
            }
        }

        localStorage.setItem("score", parseInt(localStorage.getItem('score')) + 1);
        // console.log(localStorage.getItem('score'));

        // localStorage.removeItem("score");
        // localStorage.setItem("score",result);


    }

    function calculator() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/v1/question",
            success: function (list) {
                localStorage.setItem("score", 0);
                for (let i = 0; i < list.length; i++) {
                    // let radio=document.getElementsByName(list[i].id);
                    // console.log(list[i].id);
                    //truyền vào id của câu hỏi
                    isCheck(list[i].id);
                }

            },
        });
        console.log(localStorage.getItem('score'));
        alert(localStorage.getItem('score'));
        localStorage.clear();
    }

    function addQuizz() {
        $('#exampleModal').modal('show');

    }

    function closeModal() {
        $('#exampleModal').modal('hide');
    }

    function loadAnswer(data) {
        let str = "";
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/v1/answer/" + data.id,
            success: function (list) {
                if (data.type == 1) {
                    for (let i = 0; i < list.length; i++) {
                        str += `
                                <input type="radio" id="${list[i].id}" name="${data.id}" >
                                <label for="${list[i].id}">${list[i].name}</label><br>
                       `;
                    }
                } else {
                    for (let i = 0; i < list.length; i++) {
                        str += `
                                <input type="checkbox" id="${list[i].id}" name="${data.id}" >
                                <label for="${list[i].id}"> ${list[i].name}</label><br>
                       `;
                    }
                }
                document.getElementById('answer' + data.id).innerHTML = str;
            },
        });
    }

    function load() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/v1/question",
            success: function (list) {
                let str = "";
                for (let i = 0; i < list.length; i++) {
                    str += `<h4>Cau hoi ${list[i].id}: ${list[i].content}=</h4>
                <div id="answer${list[i].id}"></div>
                `;
                    loadAnswer(list[i]);
                }
                document.getElementById('quizz__question').innerHTML = str;
            },
        });
    }

    function addAnswer() {
        number+=1;
        let str=document.getElementById("modal__body").innerHTML;
        str += `<div>
                <input type="text" placeholder="text" size="40" style="margin-right: 1rem" id="${number}">
                <input type="checkbox" placeholder="answer" name="answer">
                </div>
                `
        document.getElementById('modal__body--question').innerHTML = str;
        console.log(number);

    }
</script>

</body>
</html>